# RTSP ìŠ¤íŠ¸ë¦¼ ì´ë²¤íŠ¸ ê°€ì´ë“œ

## ğŸ¥ RTSP ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ íë¦„

```
RTSP ìŠ¤íŠ¸ë¦¼ (ì‹¤ì‹œê°„ ì¹´ë©”ë¼)
    â†“
ë§¤ í”„ë ˆì„ë§ˆë‹¤ ì²˜ë¦¬ (12 FPS ê¸°ë³¸)
    â†“
ì‚¬ëŒ ê°ì§€ â†’ ì¶”ì  â†’ ìì„¸ ë¶„ë¥˜ â†’ ìƒíƒœ íŒë‹¨
    â†“
ì´ë²¤íŠ¸ ìƒì„± â†’ JSON â†’ FastAPI ì„œë²„
```

---

## ğŸ“Š ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ ì¢…ë¥˜

### 1. **ì¼ë°˜ ê°ì§€ ì´ë²¤íŠ¸** (ë§¤ í”„ë ˆì„)
ì˜ìƒì—ì„œ ì‚¬ëŒì´ ê°ì§€ë˜ë©´ **í•­ìƒ** ë°œìƒí•˜ëŠ” ê¸°ë³¸ ì´ë²¤íŠ¸

```json
{
  "event_id": "550e8400-e29b-41d4-a716-446655440000",
  "category": "human",
  "track_id": 1,
  "timestamp_utc": "2024-11-14T12:34:56.789012",
  "bbox": [120, 80, 200, 400],
  "confidence": 0.85,
  "inference_latency_ms": 15,
  "pose_label": "standing",
  "pose_confidence": 0.92
}
```

**ë°œìƒ ì¡°ê±´**: ì‚¬ëŒì´ í™”ë©´ì— ìˆìœ¼ë©´ ê³„ì† ë°œìƒ
**ë°œìƒ ë¹ˆë„**: ì´ˆë‹¹ 12íšŒ (FPS ì„¤ì •ì— ë”°ë¼)

---

### 2. **ë‚™ìƒ ê°ì§€ ì´ë²¤íŠ¸** âš ï¸
ì‚¬ëŒì´ ì„œìˆë‹¤ê°€/ì•‰ì•„ìˆë‹¤ê°€ ê°‘ìê¸° ì“°ëŸ¬ì§ˆ ë•Œ

```json
{
  "event_id": "uuid",
  "category": "human",
  "track_id": 1,
  "timestamp_utc": "2024-11-14T12:35:10.123456",
  "bbox": [120, 80, 200, 400],
  "confidence": 0.85,
  "inference_latency_ms": 15,
  "pose_label": "lying",
  "pose_confidence": 0.89,
  "status": "fall_detected",      â† ì¤‘ìš”!
  "duration_seconds": 0
}
```

**ë°œìƒ ì¡°ê±´**:
- `standing` â†’ `lying` ì „í™˜
- `sitting` â†’ `lying` ì „í™˜
- `crouching` â†’ `lying` ì „í™˜

**ë°œìƒ ë¹ˆë„**: ìì„¸ ì „í™˜ ì‹œ 1íšŒë§Œ (ì¤‘ë³µ ë°œìƒ ì•ˆ í•¨)

---

### 3. **ì˜¨ì—´ì§ˆí™˜ ì£¼ì˜ ì´ë²¤íŠ¸** âš ï¸âš ï¸
ì‚¬ëŒì´ 5ë¶„ ì´ìƒ ê³„ì† ëˆ„ì›Œìˆì„ ë•Œ

```json
{
  "event_id": "uuid",
  "category": "human",
  "track_id": 1,
  "timestamp_utc": "2024-11-14T12:40:10.123456",
  "bbox": [120, 80, 200, 400],
  "confidence": 0.85,
  "inference_latency_ms": 15,
  "pose_label": "lying",
  "pose_confidence": 0.91,
  "status": "heatstroke_watch",   â† ì¤‘ìš”!
  "duration_seconds": 300
}
```

**ë°œìƒ ì¡°ê±´**:
- `lying` ìì„¸ë¥¼ **300ì´ˆ(5ë¶„)** ì´ìƒ ìœ ì§€

**ë°œìƒ ë¹ˆë„**: 5ë¶„ì— 1íšŒë§Œ (ì¤‘ë³µ ë°œìƒ ì•ˆ í•¨)

---

### 4. **ì˜¨ì—´ì§ˆí™˜ ê²½ê³  ì´ë²¤íŠ¸** ğŸš¨ğŸš¨ğŸš¨
ì‚¬ëŒì´ 15ë¶„ ì´ìƒ ê³„ì† ëˆ„ì›Œìˆì„ ë•Œ

```json
{
  "event_id": "uuid",
  "category": "human",
  "track_id": 1,
  "timestamp_utc": "2024-11-14T12:50:10.123456",
  "bbox": [120, 80, 200, 400],
  "confidence": 0.85,
  "inference_latency_ms": 15,
  "pose_label": "lying",
  "pose_confidence": 0.93,
  "status": "heatstroke_alert",   â† ì¤‘ìš”!
  "duration_seconds": 900
}
```

**ë°œìƒ ì¡°ê±´**:
- `lying` ìì„¸ë¥¼ **900ì´ˆ(15ë¶„)** ì´ìƒ ìœ ì§€

**ë°œìƒ ë¹ˆë„**: 15ë¶„ì— 1íšŒë§Œ (ì¤‘ë³µ ë°œìƒ ì•ˆ í•¨)

---

## ğŸ”„ ì‹¤ì œ RTSP ìŠ¤íŠ¸ë¦¼ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ë³´í–‰
```
12:00:00 - ì‚¬ëŒ ë“±ì¥ (standing)
  â†’ ì¼ë°˜ ì´ë²¤íŠ¸: {"pose_label": "standing"}

12:00:01 - ê³„ì† ì„œìˆìŒ
  â†’ ì¼ë°˜ ì´ë²¤íŠ¸: {"pose_label": "standing"}

12:00:02 - ê³„ì† ì„œìˆìŒ
  â†’ ì¼ë°˜ ì´ë²¤íŠ¸: {"pose_label": "standing"}
  ... (ê³„ì†)
```

**ë°œìƒ ì´ë²¤íŠ¸**: ì¼ë°˜ ê°ì§€ ì´ë²¤íŠ¸ë§Œ (ì´ˆë‹¹ 12ê°œ)

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë‚™ìƒ ë°œìƒ
```
12:00:00 - ì„œìˆìŒ
  â†’ ì¼ë°˜ ì´ë²¤íŠ¸: {"pose_label": "standing"}

12:00:05 - ë„˜ì–´ì§!
  â†’ ë‚™ìƒ ì´ë²¤íŠ¸: {"pose_label": "lying", "status": "fall_detected"}

12:00:06 - ê³„ì† ëˆ„ì›ŒìˆìŒ
  â†’ ì¼ë°˜ ì´ë²¤íŠ¸: {"pose_label": "lying"}

12:05:05 - 5ë¶„ì§¸ ëˆ„ì›ŒìˆìŒ
  â†’ ì˜¨ì—´ì§ˆí™˜ ì£¼ì˜: {"status": "heatstroke_watch", "duration_seconds": 300}

12:15:05 - 15ë¶„ì§¸ ëˆ„ì›ŒìˆìŒ
  â†’ ì˜¨ì—´ì§ˆí™˜ ê²½ê³ : {"status": "heatstroke_alert", "duration_seconds": 900}
```

**ë°œìƒ ì´ë²¤íŠ¸**:
- ì¼ë°˜ ì´ë²¤íŠ¸ (ë§¤ í”„ë ˆì„)
- ë‚™ìƒ ì´ë²¤íŠ¸ (1íšŒ)
- ì˜¨ì—´ì§ˆí™˜ ì£¼ì˜ (1íšŒ)
- ì˜¨ì—´ì§ˆí™˜ ê²½ê³  (1íšŒ)

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë‹¤ì¤‘ ì‚¬ëŒ
```
RTSP í™”ë©´ì— 3ëª… ë™ì‹œ ë“±ì¥

Person 1 (track_id: 1) - standing
  â†’ {"track_id": 1, "pose_label": "standing"}

Person 2 (track_id: 2) - sitting
  â†’ {"track_id": 2, "pose_label": "sitting"}

Person 3 (track_id: 3) - lying
  â†’ {"track_id": 3, "pose_label": "lying", "status": "fall_detected"}
```

**ë°œìƒ ì´ë²¤íŠ¸**: ì´ˆë‹¹ 36ê°œ (3ëª… Ã— 12 FPS)
- ê° ì‚¬ëŒë§ˆë‹¤ ë…ë¦½ì ì¸ ì´ë²¤íŠ¸
- ê°ì ë‹¤ë¥¸ track_id

---

## ğŸ“ˆ ì´ë²¤íŠ¸ ë°œìƒ ë¹ˆë„ ê³„ì‚°

### ì •ìƒ ìƒí™© (ì‚¬ëŒ 1ëª…, ì„œìˆìŒ)
```
- ì´ˆë‹¹: 12 ì´ë²¤íŠ¸
- ë¶„ë‹¹: 720 ì´ë²¤íŠ¸
- ì‹œê°„ë‹¹: 43,200 ì´ë²¤íŠ¸
```

### íŠ¹ìˆ˜ ìƒí™© (ì‚¬ëŒ 1ëª…, ë‚™ìƒ)
```
- ë‚™ìƒ ìˆœê°„: 1 ì´ë²¤íŠ¸ (ì¶”ê°€)
- 5ë¶„ í›„: 1 ì´ë²¤íŠ¸ (ì¶”ê°€)
- 15ë¶„ í›„: 1 ì´ë²¤íŠ¸ (ì¶”ê°€)
ì´: 43,203 ì´ë²¤íŠ¸/ì‹œê°„
```

### ë‹¤ì¤‘ ì‚¬ëŒ (3ëª…)
```
- ì´ˆë‹¹: 36 ì´ë²¤íŠ¸ (12 Ã— 3ëª…)
- ë¶„ë‹¹: 2,160 ì´ë²¤íŠ¸
- ì‹œê°„ë‹¹: 129,600 ì´ë²¤íŠ¸
```

---

## ğŸ›ï¸ ì´ë²¤íŠ¸ ì„¤ì • (.env)

```bash
# ë‚™ìƒ ê°ì§€ ë¯¼ê°ë„
POSE_STATE_MIN_CONFIDENCE=0.35  # 0.35 ì´ìƒì¼ ë•Œë§Œ ì´ë²¤íŠ¸ ë°œìƒ

# ì˜¨ì—´ì§ˆí™˜ íƒ€ì´ë¨¸ ì„¤ì •
POSE_HEATSTROKE_WATCH_SECONDS=300   # 5ë¶„ (ë³€ê²½ ê°€ëŠ¥)
POSE_HEATSTROKE_ALERT_SECONDS=900   # 15ë¶„ (ë³€ê²½ ê°€ëŠ¥)

# FPS ì„¤ì • (ì´ë²¤íŠ¸ ë¹ˆë„)
STREAM_DEFAULT_FPS=12  # ì´ˆë‹¹ 12ê°œ ì´ë²¤íŠ¸
```

---

## ğŸ” ì´ë²¤íŠ¸ í•„í„°ë§ ì˜ˆì‹œ

### FastAPI ì„œë²„ì—ì„œ í•„í„°ë§

```python
# ì¤‘ìš” ì´ë²¤íŠ¸ë§Œ ì²˜ë¦¬
if event.get("status") in ["fall_detected", "heatstroke_watch", "heatstroke_alert"]:
    send_alert(event)  # ì•ŒëŒ ì „ì†¡
else:
    log_event(event)   # ë‹¨ìˆœ ë¡œê¹…
```

### íŠ¹ì • ìì„¸ë§Œ ëª¨ë‹ˆí„°ë§

```python
# lying ìì„¸ë§Œ ì²˜ë¦¬
if event.get("pose_label") == "lying":
    track_lying_person(event)
```

### íŠ¹ì • ì‚¬ëŒë§Œ ì¶”ì 

```python
# track_idê°€ 5ì¸ ì‚¬ëŒë§Œ
if event.get("track_id") == 5:
    monitor_specific_person(event)
```

---

## âš¡ ì„±ëŠ¥ ìµœì í™” íŒ

### 1. FPS ì¡°ì ˆë¡œ ì´ë²¤íŠ¸ ë¹ˆë„ ê°ì†Œ
```bash
# .env
STREAM_DEFAULT_FPS=6  # ì´ˆë‹¹ 6ê°œë¡œ ê°ì†Œ (50% ì ˆê°)
```

### 2. ì¤‘ìš” ì´ë²¤íŠ¸ë§Œ ì €ì¥
```python
# ì„œë²„ì—ì„œ
if "status" in event:  # status ìˆëŠ” ê²ƒë§Œ DB ì €ì¥
    db.save(event)
```

### 3. ë°°ì¹˜ ì²˜ë¦¬
```python
# ë§¤ í”„ë ˆì„ë§ˆë‹¤ ì „ì†¡í•˜ì§€ ì•Šê³  ë°°ì¹˜ë¡œ
events_batch = []
for event in events:
    events_batch.append(event)
    if len(events_batch) >= 100:
        send_to_server(events_batch)
        events_batch = []
```

---

## ğŸ“ ìš”ì•½

### RTSP ìŠ¤íŠ¸ë¦¼ì—ì„œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸:

1. **ì¼ë°˜ ê°ì§€ ì´ë²¤íŠ¸** - ì‚¬ëŒì´ ìˆìœ¼ë©´ í•­ìƒ (ì´ˆë‹¹ 12ê°œ)
2. **ë‚™ìƒ ê°ì§€** - ì„œìˆë‹¤ê°€/ì•‰ì•˜ë‹¤ê°€ ì“°ëŸ¬ì§ˆ ë•Œ (1íšŒë§Œ)
3. **ì˜¨ì—´ì§ˆí™˜ ì£¼ì˜** - 5ë¶„ ì´ìƒ ëˆ„ì›Œìˆì„ ë•Œ (1íšŒë§Œ)
4. **ì˜¨ì—´ì§ˆí™˜ ê²½ê³ ** - 15ë¶„ ì´ìƒ ëˆ„ì›Œìˆì„ ë•Œ (1íšŒë§Œ)

### ëª¨ë“  ì´ë²¤íŠ¸ ê³µí†µ ì •ë³´:
- event_id (ê³ ìœ  ID)
- category (human/wildlife)
- track_id (ì‚¬ëŒ ë²ˆí˜¸)
- timestamp_utc (ì •í™•í•œ ì‹œê°)
- bbox (ìœ„ì¹˜)
- confidence (ê°ì§€ ì‹ ë¢°ë„)
- pose_label (sitting/standing/lying)
- pose_confidence (ìì„¸ ë¶„ë¥˜ ì‹ ë¢°ë„)

### íŠ¹ìˆ˜ ì´ë²¤íŠ¸ ì¶”ê°€ ì •ë³´:
- status (fall_detected/heatstroke_watch/heatstroke_alert)
- duration_seconds (ì§€ì† ì‹œê°„)
